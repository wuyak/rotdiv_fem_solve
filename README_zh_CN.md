<p style="text-align: center;">
    æ—‹åº¦-æ•£åº¦æ··åˆæœ‰é™å…ƒæ±‚è§£å™¨<br>
    è‡ªåŠ¨åŒ– FreeFEM++ æ•°å€¼å®éªŒç³»ç»Ÿ â€” æ‰¹é‡æ±‚è§£å™¨ç”Ÿæˆä¸æ‰§è¡Œæ¡†æ¶
</p>

<p style="text-align: center;">
    ä¸­æ–‡ Â· [<a href="./README.md">English</a>]
</p>

---

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

- **FreeFEM++ 4.0+** â€”â€” æœ‰é™å…ƒæ±‚è§£å™¨
- **Python 3.8+** â€”â€” æµç¨‹ç®¡ç†

### Python ä¾èµ–

```bash
pip install -r requirements.txt
```

**requirements.txt**ï¼š
```txt
jinja2>=3.1.0    # æ¨¡æ¿å¼•æ“
sympy>=1.12      # ç¬¦å·è®¡ç®—
```

### å¯é€‰è½¯ä»¶

- **Ghostscript** â€”â€” EPS â†’ PNG/PDF å›¾åƒæ ¼å¼è½¬æ¢

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
python pipeline.py    # ç”Ÿæˆ â†’ æ±‚è§£ â†’ è½¬æ¢
```

> ğŸ’¡ å›¾åƒè½¬æ¢æ­¥éª¤éœ€è¦ Ghostscriptã€‚è‹¥æœªå®‰è£…ï¼Œå¯æ‰§è¡Œï¼š

```bash
python pipeline.py --step solve    # ç”Ÿæˆ â†’ æ±‚è§£
```

**æ‰§è¡Œç¤ºä¾‹**ï¼š
```text
æ‰¹é‡ç”Ÿæˆ 24 ä¸ª FreeFEM++ è„šæœ¬
ä½¿ç”¨ 4 ä¸ªå¹¶è¡Œä»»åŠ¡
[1/24] [OK] Dirichlet_Trig_Square/BDM1_P2
...
[24/24] [OK] Magnetic_Trig_Lshaped/BDM2Ortho_P3

Generated: 24 succeeded, 0 failed
Summary: 24/24 succeeded

[SUCCESS] Pipeline completed in 20.3s
```

---

## ğŸ“ é¡¹ç›®å®šä½

### FreeFEM++ çš„æ ¸å¿ƒåŠŸèƒ½

FreeFEM++ åœ¨äºŒç»´æ··åˆæœ‰é™å…ƒæ±‚è§£æ–¹é¢å…·æœ‰æˆç†Ÿçš„ç½‘æ ¼ç”Ÿæˆèƒ½åŠ›å’Œä¸°å¯Œçš„å‡½æ•°ç©ºé—´æ”¯æŒï¼Œå¯ä»¥ç¨³å®šé«˜æ•ˆåœ°å¤„ç†å¤æ‚çš„åå¾®åˆ†æ–¹ç¨‹ç»„ã€‚è´Ÿè´£æœ‰é™å…ƒç¦»æ•£åŒ–ã€çº¿æ€§ç³»ç»Ÿæ±‚è§£å’Œæ•°å€¼ç»“æœè¾“å‡ºã€‚

### æ•°å€¼å®éªŒçš„å…¶ä»–ç¯èŠ‚

è¿›è¡Œå¤§è§„æ¨¡æ•°å€¼å®éªŒæ—¶ï¼Œé™¤äº†æ±‚è§£å™¨æœ¬èº«ï¼Œè¿˜éœ€è¦ï¼š

1. **ç¬¦å·è®¡ç®—** â€”â€” ä»ç»™å®šçš„ç²¾ç¡®è§£æ¨å¯¼åå¯¼æ•°ã€æ•£åº¦ã€æ—‹åº¦å’Œæºé¡¹è¡¨è¾¾å¼ï¼Œç”¨äºè¯¯å·®éªŒè¯
2. **æ‰¹é‡ä»£ç ç”Ÿæˆ** â€”â€” é’ˆå¯¹å¤šå‚æ•°ç»„åˆï¼ˆè¾¹ç•Œæ¡ä»¶ Ã— è®¡ç®—åŸŸ Ã— æœ‰é™å…ƒç©ºé—´ï¼‰è‡ªåŠ¨ç”Ÿæˆæ±‚è§£å™¨è„šæœ¬
3. **å›¾åƒæ ¼å¼è½¬æ¢** â€”â€” å°† FreeFEM++ è¾“å‡ºçš„ EPS æ ¼å¼è½¬æ¢ä¸º PNG æ ¼å¼

### æœ¬é¡¹ç›®çš„ä½œç”¨

æœ¬é¡¹ç›®ä¸º FreeFEM++ è¡¥å……å‰å¤„ç†å’Œåå¤„ç†åŠŸèƒ½ï¼š

**å·¥ä½œæµç¨‹**ï¼š
1. **SymPy ç¬¦å·æ¨å¯¼** â€”â€” ç»™å®šç²¾ç¡®è§£ï¼Œè‡ªåŠ¨æ¨å¯¼åå¯¼æ•°ã€æ•£åº¦ã€æ—‹åº¦å’Œæºé¡¹
2. **Jinja2 æ¨¡æ¿å¼•æ“** â€”â€” å°†é…ç½®å‚æ•°æ³¨å…¥ FreeFEM++ è„šæœ¬æ¨¡æ¿ï¼Œæ‰¹é‡ç”Ÿæˆæ±‚è§£å™¨
3. **Python æµç¨‹ç®¡ç†** â€”â€” åè°ƒç”Ÿæˆã€æ±‚è§£å’Œæ•°å€¼ç»“æœå­˜å‚¨ï¼Œæ”¯æŒå¤šæ ¸å¹¶è¡Œ
4. **Ghostscript å›¾åƒè½¬æ¢** â€”â€” æ‰¹é‡è½¬æ¢ EPS å›¾åƒä¸º PNG æ ¼å¼

**æ‹“å±•å®éªŒ**ï¼šæ–°å¢å®éªŒä»…éœ€åœ¨å‡½æ•°åº“ä¸­å®šä¹‰æµ‹è¯•å‡½æ•°é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆè„šæœ¬ç”Ÿæˆã€æ±‚è§£å’Œç»“æœåˆ†æå…¨æµç¨‹

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
rot_div_refactor/
â”œâ”€â”€ pipeline.py                       # ä¸»å…¥å£ï¼Œåè°ƒä¸‰ä¸ªæ‰§è¡Œé˜¶æ®µ
â”œâ”€â”€ requirements.txt                  # Python ä¾èµ–æ¸…å•
â”œâ”€â”€ scripts/                          # Python æ¨¡å—
â”‚   â”œâ”€â”€ batch_generate.py             # æ‰¹é‡ç”Ÿæˆæ±‚è§£å™¨è„šæœ¬
â”‚   â”œâ”€â”€ run_freefem.py                # FreeFEM++ å¹¶è¡Œæ±‚è§£
â”‚   â”œâ”€â”€ convert_plots.py              # Ghostscript å›¾åƒè½¬æ¢
â”‚   â”œâ”€â”€ template_generator.py         # Jinja2 æ¨¡æ¿æ¸²æŸ“å¼•æ“
â”‚   â”œâ”€â”€ symbolic_derivatives.py       # SymPy ç¬¦å·è®¡ç®—
â”‚   â”œâ”€â”€ function_library.py           # æµ‹è¯•å‡½æ•°é…ç½®åº“
â”‚   â””â”€â”€ parallel_runner.py            # å¹¶è¡Œæ¡†æ¶
â”œâ”€â”€ templates/                        # Jinja2 æ¨¡æ¿
â”‚   â”œâ”€â”€ solver.edp.j2                 # FreeFEM++ ä¸»æ±‚è§£å™¨æ¨¡æ¿
â”‚   â””â”€â”€ includes/                     # å­æ¨¡æ¿ï¼ˆç½‘æ ¼ã€è¯¯å·®ã€è¾“å‡ºã€ç»˜å›¾ï¼‰
â”‚       â”œâ”€â”€ arrays.idp.j2
â”‚       â”œâ”€â”€ mesh.idp.j2
â”‚       â”œâ”€â”€ errors.idp.j2
â”‚       â”œâ”€â”€ output.idp.j2
â”‚       â””â”€â”€ plot.idp.j2
â””â”€â”€ output/                           # è¾“å‡ºç›®å½•
```

**æ ¸å¿ƒæ–‡ä»¶è¯´æ˜**ï¼š
- `function_library.py` â€”â€” æµ‹è¯•å‡½æ•°é…ç½®åº“ï¼ˆæ–°å¢æµ‹è¯•å‡½æ•°ï¼‰
- `batch_generate.py` â€”â€” FreeFEM++ è„šæœ¬ç”Ÿæˆå™¨
- `pipeline.py` â€”â€” ä¸»å…¥å£å’Œæµç¨‹æ§åˆ¶
- `templates/solver.edp.j2` â€”â€” FreeFEM++ æ±‚è§£è„šæœ¬ä¸»æ¨¡ç‰ˆ
- `templates/includes/*.idp.j2` â€”â€” å­æ¨¡æ¿ï¼ˆç½‘æ ¼ç”Ÿæˆã€è¯¯å·®è®¡ç®—ã€ç»“æœè¾“å‡ºã€å›¾åƒç»˜åˆ¶ï¼‰

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### æ‰§è¡Œå®Œæ•´æµç¨‹

```bash
python pipeline.py                  # ç”Ÿæˆ + æ±‚è§£ + è½¬æ¢
python pipeline.py --step generate  # ä»…ç”Ÿæˆè„šæœ¬
python pipeline.py --step solve     # ç”Ÿæˆ + æ±‚è§£ï¼ˆä¸è½¬æ¢å›¾åƒï¼‰
```

### ç­›é€‰é…ç½®

```bash
python pipeline.py --filter Dirichlet_Trig_Square    # ç»„åˆç­›é€‰
python pipeline.py --filter BDM2                     # æ‰€æœ‰ BDM2 ç©ºé—´
```

### è¾“å‡ºæ§åˆ¶

```bash
python pipeline.py --output workspace    # æŒ‡å®šè¾“å‡ºç›®å½•
python pipeline.py --dpi 300             # é«˜åˆ†è¾¨ç‡å›¾åƒ
```

### è¾“å‡ºç»“æ„

```
output/
â””â”€â”€ {BoundaryCondition}_{Function}_{Domain}/
    â””â”€â”€ {FESpace}_{LagrangeSpace}/
        â”œâ”€â”€ solver.edp           # FreeFEM++ æ±‚è§£å™¨
        â”œâ”€â”€ results.dat          # æ•°å€¼è§£æ•°æ®
        â”œâ”€â”€ summary.txt          # æ”¶æ•›ç‡æŠ¥å‘Š
        â””â”€â”€ eps/
            â”œâ”€â”€ *.eps            # åŸå§‹å›¾åƒ
            â””â”€â”€ png/
                â””â”€â”€ *.png        # è½¬æ¢åå›¾åƒ
```

### è¾“å‡ºç¤ºä¾‹

**æ”¶æ•›ç‡åˆ†ææŠ¥å‘Š** (`summary.txt`)ï¼š
```
========================================
Convergence Analysis Report
========================================
Problem: Dirichlet_Trigonometric_Square
Finite Element: BDM1 + P2
Mesh refinements: 4
========================================

========================================
H1 Error of u
========================================
Mesh    Error          Rate
----------------------------------------
  0     1.234e-01   -
  1     3.089e-02   2.00
  2     7.721e-03   2.00
  3     1.930e-03   2.00
```

---

## ğŸ”§ æ‰©å±•

### æ·»åŠ æµ‹è¯•å‡½æ•°

ç¼–è¾‘ `scripts/function_library.py`ï¼š

```python
FUNCTION_LIBRARY = {
    'Dirichlet': {
        'MyFunction': {
            'u1': 'x**2 * (1-x)**2 * y',
            'u2': '-x * y**2 * (1-y)**2',
            'domain': ['Square']
        }
    }
}
```

ç„¶åè¿è¡Œï¼š
```bash
python pipeline.py --filter MyFunction
```

### æ·»åŠ æœ‰é™å…ƒç©ºé—´

ç¼–è¾‘ `scripts/batch_generate.py` ä¸­çš„ `FESPACE_COMBINATIONS`ï¼š

```python
FESPACE_COMBINATIONS = {
    'Dirichlet': [
        ('BDM1', 'P2'),
        ('BDM2', 'P3'),
        ('RT2', 'P2'),    # æ–°å¢ Raviart-Thomas ç©ºé—´
    ],
}
```

### è‡ªå®šä¹‰ç½‘æ ¼ç»†åŒ–

ä¿®æ”¹ç”Ÿæˆçš„ `solver.edp` æ–‡ä»¶æˆ–ä¼ é€’ FreeFEM++ å‚æ•°ï¼š

```bash
FreeFem++ solver.edp -nref 5    # 5 æ¬¡è‡ªé€‚åº”ç»†åŒ–
```

---